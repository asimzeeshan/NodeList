var clipboard;$(function(){$("#add-new-machine").on("click",function(a){a.preventDefault(),$("#modal-machine input[name=id]").val(""),$("#modal-machine .modal-title").html("New Machine"),$("#modal-machine .btn-primary").html('<i class="fa fa-save"></i> <span class="d-none d-md-inline">Add Machine</span>'),$("#modal-machine .btn-danger").addClass("d-none"),$("#modal-machine .btn-danger").removeAttr("data-id"),$("#modal-machine").modal("show")}),$("#hide-inactive-vm").on("click",function(a){a.preventDefault();var e=$('<form method="post" />').html('<input type="hidden" name="hideInactiveVM" />');$("body").append(e),e.submit()}),$("#show-inactive-vm").on("click",function(a){a.preventDefault();var e=$('<form method="post" />').html('<input type="hidden" name="showInactiveVM" />');$("body").append(e),e.submit()}),$("#modal-machine").on("hide.bs.modal",function(){$("#modal-machine .is-invalid").removeClass("is-invalid"),$('#modal-machine [name="isActive"]').parent().parent().parent().addClass("d-none"),$("#response").html(""),$("#modal-machine form")[0].reset(),$("#ip-address div").not(":last").remove(),$("select").selectpicker("refresh")}),$("#modal-machine").on("shown.bs.modal",function(){$("select").selectpicker("destroy").selectpicker({noneSelectedText:"(Empty)"}),$("input.price").maskMoney("destroy").maskMoney(),$(".date").datepicker("destroy").datepicker({todayHighlight:!0,format:"yyyy-mm-dd",autoclose:!0}).on("hide",function(){return!1}),$("input.number").off("input").on("input",function(){$(this).val($(this).val().replace(/[^0-9]/g,""))}),$(".add-ip-address").off("click").on("click",function(a){a.preventDefault();var e=$(this).parent().parent();e.clone(!0).appendTo(e.parent()).find("input[type=text]").val(""),$(this).html('<i class="fa fa-minus-circle"></i>').off("click").on("click",function(a){a.preventDefault(),e.remove()})})}),$("#modal-machine .btn-primary").on("click",function(a){a.preventDefault(),$("#modal-machine .is-invalid").removeClass("is-invalid");var e=$(this),t=e.width(),n=e.html();e.attr("disabled",!0).width(t).html('<i class="fa fa-refresh fa-spin"></i><span class="d-xs-none"> Saving...</span>'),$.post(url.save_machine,$("#modal-machine form").serialize(),function(a){e.attr("disabled",!1).html(n),"OK"!=a.status?($('#modal-machine [name="'+a.name+'"]').addClass("is-invalid"),$("#response").html(a.response)):window.location.href=window.location.href},"json")}),$("#modal-machine .btn-danger").on("click",function(a){a.preventDefault();var e=$(this),t=e.width();e.html();e.attr("disabled",!0).width(t).html('<i class="fa fa-refresh fa-spin"></i> Wait...');var n=$('<form method="post">').html('<input type="hidden" name="remove" value="'+$(this).attr("data-id")+'">');n.appendTo("body"),n.submit()}),$("#modal-provider .btn-primary").on("click",function(a){a.preventDefault(),$("#modal-provider .is-invalid").removeClass("is-invalid");var e=$(this),t=e.width(),n=e.html();e.attr("disabled",!0).width(t).html('<i class="fa fa-refresh fa-spin"></i><span class="d-xs-none"> Saving...</span>'),$.post(url.save_provider,$("#modal-provider form").serialize(),function(a){e.attr("disabled",!1).html(n),"OK"!=a.status?($('#modal-provider [name="'+a.name+'"]').addClass("is-invalid"),$("#response").html(a.response)):window.location.href=window.location.href},"json")}),$("#machine-list").dataTable({pageLength:50,dom:'<"pull-right"f>rt<"bottom pull-right"ip>',stateSave:!0,order:[[0,"asc"]],language:{search:"",searchPlaceholder:"Search Machine...",info:"",infoEmpty:"",infoFiltered:""},drawCallback:function(){$('[data-toggle="tooltip"]').tooltip(),clipboard&&clipboard.destroy(),(clipboard=new Clipboard(".machine-ip",{text:function(a){return $(a).data("clipboard-text")?$(a).data("clipboard-text"):$(a).text().trim()}})).on("success",function(a){$(a.trigger).fadeOut(100).fadeIn(500)}),$(".edit-machine, .machine-name").off("click").on("click",function(a){a.preventDefault();var e=$(this).attr("data-id");$.getJSON(url.get_machine,{id:e}).done(function(a){if("OK"!=a.status)return alert(a.response),void(window.location.href=window.location.href);$("#modal-machine .modal-title").html(a.label),$("#modal-machine [name=id]").val(e),$("#modal-machine .btn-primary").html('<i class="fa fa-save"></i> <span class="d-none d-md-inline">Save Changes</span>'),$("#modal-machine [name=isActive]").parent().parent().parent().removeClass("d-none"),$("#modal-machine [name=isActive]").prop("checked",!!a.is_active),$("#modal-machine [name=label]").val(a.label),$("#modal-machine [name=vmType]").val(a.vm_type),$("#modal-machine [name=memory]").val(a.total_ram),$("#modal-machine [name=memoryUnit]").val(a.ram_unit),$("#modal-machine [name=swap]").val(a.total_swap),$("#modal-machine [name=swapUnit]").val(a.swap_unit),$("#modal-machine [name=diskSpace]").val(a.total_disk_space),$("#modal-machine [name=diskSpaceUnit]").val(a.disk_space_unit),$("#modal-machine [name=hddType]").val(a.hdd_type),$("#modal-machine [name=bandwidth]").val(a.total_bandwidth),$("#modal-machine [name=bandwidthUnit]").val(a.bandwidth_unit),$("#modal-machine [name=countryCode]").val(a.country_code),$("#modal-machine [name=cityName]").val(a.city_name),$("#modal-machine [name=providerId]").val(a.provider_id),$("#modal-machine [name=currencyCode]").val(a.currency_code),$("#modal-machine [name=price]").val(a.price),$("#modal-machine [name=billingCycle]").val(a.billing_cycle),$("#modal-machine [name=dueDate]").val(a.due_date),$("#modal-machine [name=notes]").val(a.notes),$('#modal-machine [name="isNat"]').prop("checked",!!a.is_nat);var t=a.ip_address.split(";"),n=$('#modal-machine [name="ipAddress\\[\\]"]').parent();$.each(t,function(a,e){n.clone().appendTo(n.parent()).find("input[type=text]").val(e)}),n.remove(),$("#ip-address .add-ip-address").not(":last").html('<i class="fa fa-minus-circle"></i>').off("click").on("click",function(a){a.preventDefault(),$(this).parent().parent().remove()}),$("#ip-address .add-ip-address:last").on("click",function(a){a.preventDefault();var e=$(this).parent().parent();e.clone(!0).appendTo(e.parent()).find("input[type=text]").val(""),$(this).html('<i class="fa fa-minus-circle"></i>').off("click").on("click",function(a){a.preventDefault(),e.remove()})}),$("#modal-machine .btn-danger").removeClass("d-none"),$("#modal-machine .btn-danger").attr("data-id",e),$("select").selectpicker("refresh"),$("#modal-machine").modal("show")})}),$(".edit-provider").off("click").on("click",function(a){a.preventDefault();var e=$(this).attr("data-id");$.getJSON(url.get_provider,{id:e}).done(function(a){$("#modal-provider .modal-title").html(a.name),$("#modal-provider [name=id]").val(e),$("#modal-provider [name=name]").val(a.name),$("#modal-provider [name=website]").val(a.website),$("#modal-provider [name=controlPanel]").val(a.control_panel),$("#modal-provider [name=cpUrl]").val(a.cp_url),$("#modal-provider").modal("show")})}),$(".renew-machine").off("click").on("click",function(a){a.preventDefault(),$.post(url.renew_machine,{id:$(this).parent().parent().parent().parent().data("id")},function(a){"OK"!=a.status?alert(a.response):window.location.href=window.location.href},"json")})},columnDefs:[{targets:"no-sort",orderable:!1},{targets:[7],type:"non-empty-string"},{targets:0,render:function(a,e,t){return"sort"!=e?a:a.replace(/<span.+span> /,"")}},{targets:1,sType:"numeric",render:function(a,e,t){switch(e){case"sort":var n=a.split(";"),i=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/gi.exec(n[0])[1].split(".");return parseInt(i[0])*Math.pow(256,3)+parseInt(i[1])*Math.pow(256,2)+256*parseInt(i[2])+parseInt(i[3]);case"display":var r=a.replace(/<span.*/g,""),o=r.length!=a.length;return 1==(i=r.split(";")).length?(o?'<span class="badge badge-warning nat">NAT</span> ':"")+'<span class="machine-ip" data-clipboard-text="'+r+'">'+(r.length>18?r.substr(0,6)+"..."+r.substr(-2):r)+' <i class="fa fa-clipboard"></i></span>':'<div class="dropdown ip-address-list">'+(o?'\t<span class="badge badge-warning nat">NAT</span> ':"")+'\t<a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">'+(i[0].length>18?i[0].substr(0,6)+"..."+i[0].substr(-2):i[0])+'</a>\t<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">\t\t<a href="javascript:;" class="dropdown-item"><span class="machine-ip">'+i.join(' <i class="fa fa-clipboard"></i></span></li><li><span class="machine-ip">')+' <i class="fa fa-clipboard"></i></span></a>\t</div></div>'}return a}},{targets:2,render:function(a,e,t){if("sort"!=e)return a;var n=/title="([^"]+).+span> (.+)/gi.exec(a);return n[1]+" "+n[2]}},{targets:[3,4],sType:"numeric",render:function(a,e,t){if("sort"!=e)return a;var n=(a=a.replace(/<div.*/g,"")).split(" ");switch(n[1]){case"GB":return 1024*parseInt(n[0]);case"TB":return 1024*parseInt(n[0])*1024;default:return parseInt(n[0])}}},{targets:5,render:function(a,e,t){var n=a.split(";");if("display"!=e)return n[1];if(5!=n.length)return"";n[1],n[4],n[3],n[2],n[0];return'<div class="dropdown">\t<a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">'+n[1]+'</a>\t<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">\t\t<a href="'+n[4]+'" class="dropdown-item" target="_blank"><i class="fa fa-tachometer"></i> '+n[3]+'</a>\t\t<a href="'+n[2]+'" class="dropdown-item" target="_blank"><i class="fa fa-globe"></i> Website</a>\t\t<a href="javascript:;" data-id="'+n[0]+'" class="dropdown-item edit-provider"><i class="fa fa-pencil-square-o"></i> Edit Provider</a>\t</div></div>'}},{targets:6,sType:"numeric",render:function(a,e,t){switch(e){case"display":switch((n=a.split(" "))[0]){case"2":t={color:"primary",text:"Quarterly"};break;case"3":t={color:"secondary",text:"Semi-Yearly"};break;case"4":t={color:"danger",text:"Yearly"};break;case"5":t={color:"warning",text:"Bi-Yearly"};break;default:t={color:"success",text:"Monthly"}}return'<span class="badge badge-'+t.color+'" data-toggle="tooltip" data-placement="top" title="'+t.text+'">'+t.text.substr(0,1)+"</span> "+n[1]+" "+n[2];case"sort":var n=a.split(" "),i=parseFloat(n[2]);switch($.each(currencies,function(a,e){a==n[1]&&(i=parseFloat($parts[2]*e.rate))}),n[0]){case"2":return i/3;case"3":return i/6;case"4":return i/12;case"5":return i/24;default:return i}default:return a}}},{targets:7,sType:"numeric",render:function(a,e,t){if("display"!=e)return a;if(!a)return a;var n=new Date,i=new Date(1e3*a),r=new Date(n.getTime()+6048e5),o=(i.getUTCDate()<10?"0":"")+i.getUTCDate(),l=(i.getUTCMonth()<9?"0":"")+(i.getUTCMonth()+1),d=i.getUTCFullYear();if(i>n)var s="Expires on "+parseInt((i-n)/86400/1e3)+" days later";return'<div class="dropdown" data-toggle="tooltip" title="'+(i<n?"Expired":s)+'">\t<a class="dropdown-toggle'+(n>i?" text-danger":r>i?" text-warning":"")+'" href="#" role="button" data-toggle="dropdown">'+(n>i?'<i class="fa fa-exclamation-circle"></i> ':r>i?'<i class="fa fa-exclamation"></i> ':"")+d+"-"+l+"-"+o+'</a>\t<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">\t\t<a href="javascript:;" class="dropdown-item renew-machine"><i class="fa fa-refresh"></i> Renew</a>\t</div></div>'}}]}),$.get(url.get_location,function(a){$('input[name="cityName"]').typeahead({source:a})},"json"),$.get(url.get_control_panel,function(a){$('input[name="controlPanel"]').typeahead({source:a})},"json")}),$.fn.selectpicker.Constructor.BootstrapVersion="4",$.extend($.fn.dataTableExt.oSort,{"non-empty-string-asc":function(a,e){return""==a?1:""==e?-1:a<e?-1:a>e?1:0},"non-empty-string-desc":function(a,e){return""==a?1:""==e?-1:a<e?1:a>e?-1:0}});